- hosts: cluster
  become: True
  gather_facts: False
  tasks:
  - name: "Wait for port 3333 to be ready"
    local_action: wait_for port=3333 host="{{ inventory_hostname }}" state=started connect_timeout=2 timeout=600


- hosts: front
  become: True
  vars_files:
    - vars/main.yml
   pre_tasks:
    - name: "Create root prestashop directory for archive"
      file: path="{{ documentroot }}" state=directory mode="u=rwx,g=rx,o=rx" owner=www-data group=www-data
    
    - name: "Install missing package if needed"
      apt: name={{ item }} update_cache=yes
      with_items:
        - unzip
      
  roles:
    - { role: geerlingguy.apache }
    - { role: geerlingguy.php }
    - { role: geerlingguy.apache-php-fpm  }
    - { role: carlosbuenosvinos.ansistrano-deploy }

- hosts: back
  become: True
  vars_files:
    - vars/main.yml
    - [ "vars/{{ mysql_role }}.yml", "vars/mysql_default.yml" ]
    
  tasks:
  - name: "install missing package if needed"
    apt: name={{ item }} update_cache=yes
    with_items:
      - htop
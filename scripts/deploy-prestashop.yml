- hosts: "{{ target }}"
  become: True
  gather_facts: False
  tasks:
  - name: "Wait for port 3333 to be ready"
    local_action: wait_for port=3333 host="{{ inventory_hostname }}" state=started connect_timeout=2 timeout=600


- hosts: "{{ target }}"
  become: True
  vars_files:
    - vars/main.yml
  roles:
    - { role: geerlingguy.apache }
    - { role: geerlingguy.php }
    - { role: geerlingguy.apache-php-fpm  }

  tasks:
  - name: "install missing package if needed"
    apt: name={{ item }} update_cache=yes
    with_items:
      - curl
      - htop